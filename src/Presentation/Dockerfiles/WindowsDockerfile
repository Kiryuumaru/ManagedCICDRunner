FROM mcr.microsoft.com/windows/servercore:ltsc2022
SHELL ["powershell"]

RUN Set-ExecutionPolicy Unrestricted

ADD "https://github.com/git-for-windows/git/releases/download/v2.45.2.windows.1/MinGit-2.45.2-64-bit.zip" ".\temp\MinGit.zip"
RUN Expand-Archive "temp\MinGit.zip" -DestinationPath .\temp\MinGit; \
    $env:PATH = $env:PATH + ';C:\MinGit\cmd\;C:\MinGit\cmd'; \
    Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment\' -Name Path -Value $env:PATH
    
ADD "https://aka.ms/vs/17/release/vs_community.exe" ".\temp\vs_community.exe"
RUN & ".\temp\vs_community.exe" --quiet --wait --norestart --noUpdateInstaller \
    --add Microsoft.VisualStudio.Workload.Azure`;includeRecommended`;includeOptional \
    --add Microsoft.VisualStudio.Workload.ManagedDesktop`;includeRecommended`;includeOptional \
    --add Microsoft.VisualStudio.Workload.NativeCrossPlat`;includeRecommended`;includeOptional \
    --add Microsoft.VisualStudio.Workload.NativeDesktop`;includeRecommended`;includeOptional \
    --add Microsoft.VisualStudio.Workload.NetCrossPlat`;includeRecommended`;includeOptional \
    --add Microsoft.VisualStudio.Workload.NetWeb`;includeRecommended`;includeOptional \
    --add Microsoft.VisualStudio.Workload.Node`;includeRecommended`;includeOptional \
    --add Microsoft.VisualStudio.Workload.Python`;includeRecommended`;includeOptional \
    --add Microsoft.VisualStudio.Workload.Python`;includeRecommended`;includeOptional \
    | Out-Default
